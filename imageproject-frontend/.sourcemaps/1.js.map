{"version":3,"sources":["../../src/pages/home/home.module.ts","../../src/pages/home/home.ts"],"names":[],"mappings":"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","file":"1.js","sourcesContent":["/**\n * Created by hsuanlee on 2017/4/4.\n */\nimport { NgModule} from '@angular/core';\nimport { HomePage} from './home';\nimport { IonicPageModule } from 'ionic-angular';\n\n@NgModule({\n    declarations: [HomePage],\n    imports: [\n        IonicPageModule.forChild(HomePage),\n\n    ],\n})\nexport class HomePageModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.module.ts","import {Component} from '@angular/core';\nimport {AlertController, IonicPage} from 'ionic-angular';\nimport {Socket} from \"ng-socket-io\";\nimport {Storage} from \"@ionic/storage\";\nimport {ChatModel} from \"../../models/chat-model\";\nimport {ChatService, UserInfo} from \"../../providers/chat-service\";\n\n@IonicPage()\n@Component({\n  selector: 'page-home',\n  templateUrl: 'home.html'\n})\nexport class HomePage {\n\n  toUser: { toUserId: string, toUserName: string };\n  chats: Array<ChatModel> = []\n  user: UserInfo\n\n  constructor(private socket: Socket, private alertCtrl: AlertController, private storage: Storage, private chatService: ChatService) {\n    this.toUser = {\n      toUserId: '210000198410281948',\n      toUserName: 'Hancock'\n    }\n    this.storage.get('user')\n      .then(result => {\n        this.user = result\n      })\n\n    this.storage.get('chats')\n      .then(result => {\n        this.chats = result ? result : []\n        console.log(this.chats)\n      })\n\n    this.socket.on('newConversationSuccessful', data => {\n      console.log(data)\n      this.chats.push({\n        toUserId: data.user.userID,\n        toUserName: data.user.name,\n        photo: data.user.photoUrl,\n        message: data.message,\n        messages: [{\n          time: Date.now(),\n          userId: this.user.id,\n          userName: this.user.name,\n          toUserId: this.user.id,\n          userAvatar: this.user.thumbSrc,\n          message: data.message\n        }]\n      })\n      this.storage.set('chats', this.chats)\n    })\n\n\n\n  }\n\n  ionViewDidEnter() {\n    console.log('home view entered')\n    this.storage.get('chats')\n      .then(result => {\n        this.chats = result ? result : []\n        console.log(this.chats)\n      })\n    this.socket.on('newMessage', data => {\n      data['toUserId'] = this.user.id\n      // data['userName'] = data.userName\n      // data['userAvatar'] = data.userAvatar\n      data['time'] = Date.now()\n      console.log(data)\n      this.chatService.addMessageToList(data)\n        .then(res => {\n          this.chats = res\n        })\n      // this.storage.get('chats')\n      //   .then(result => {\n      //     this.chats = result\n      //   })\n    })\n  }\n\n  ionViewWillLeave() {\n    console.log('home view left')\n    this.socket.removeListener('newMessage')\n  }\n\n  presentPrompt() {\n    let alert = this.alertCtrl.create({\n      title: 'Send New Message',\n      inputs: [\n        {\n          name: 'username',\n          placeholder: 'Username'\n        },\n        {\n          name: 'body',\n          placeholder: 'Message',\n          type: 'textarea'\n        }\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          role: 'cancel',\n          handler: data => {\n            console.log('Cancel clicked');\n          }\n        },\n        {\n          text: 'Send',\n          handler: data => {\n            if (data.username && data.body) {\n              this.storage.get('api')\n                .then(result => {\n                  data['avatar'] = this.user.thumbSrc\n                  this.socket.emit('newConversation', {api: result, data: data})\n                })\n            }\n          }\n        }\n      ]\n    });\n    alert.present();\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/home/home.ts"],"sourceRoot":""}